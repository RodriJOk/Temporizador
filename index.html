<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>Temporizador en Javascript</title>
</head>
<body>
    <header>
        <h1 class="header">Temporizador en Javascript</h1>
    </header>
    <main class="message">
        <h2>Por favor, ingresa un valor, para iniciar el temporizador</h2>
    </main>
    <section>
        <div class="container-tiempoRestante">
            <div class="horas_container">   
                <span>Horas</span>
                <input type="text" value="" placeholder="00" id="horas">
            </div>
            <p>:</p>
            <div class="minutos_container">   
                <span>Minutos</span>
                <input type="text" value="" placeholder="00" id="minutos" min="0" max="60">
            </div>
            <p>:</p>
            <div class="segundos_container">
                <span>Segundos</span>
                <input type="text" value="" placeholder="00" id="segundos" min="0" max="60">
            </div>
            <span>:</span>
            <div class="milisegundos_container">
                <span>Milisegundos</span>
                <input type="text" value="000" id="milisegundos" disabled>
            </div> 
        </div>
        <div class="buttons-section">
            <button id="btnPausar" onclick="pausarTemporizador()">Pausar</button>
            <button id="btnIniciar" onclick="iniciarTemporizador()">Iniciar</button>
            <button id="btnRestablecer" onclick="restablecerTemporizador()">Restablecer</button>
        </div>
    </section>
    <script>
        const btnPausar = document.getElementById('btnPausar');
        const btnIniciar = document.getElementById('btnIniciar');
        const btnRestablecer = document.getElementById('btnRestablecer');
        const las_horas = document.getElementById('horas');
        const los_minutos = document.getElementById('minutos');
        const los_segundos = document.getElementById('segundos');
        const los_milisegundos = document.getElementById('milisegundos');
        const message = document.getElementsByClassName('message')[0];
        let idInterval = null;
        let diferenciaTemporal = 0;
        let fechaFuturo = null;

        const ocultarElemento = elemento => {
            elemento.style.display = 'none';
        }

        const mostrarElemento = elemento => {
            elemento.style.display = '';
        }

        ocultarElemento(btnPausar);
        ocultarElemento(btnIniciar);
        ocultarElemento(btnRestablecer);

        los_minutos.addEventListener('keyup', () => {
            if (los_minutos.value > 59) {
                los_minutos.value = 59;
            }
        });

        los_segundos.addEventListener('keyup', () => {
            if (los_segundos.value > 59) {
                los_segundos.value = 59;
            }
        });

        los_minutos.addEventListener('change', () => {
            mostrarElemento(btnIniciar);
        });
        los_segundos.addEventListener('change', () => {
            mostrarElemento(btnIniciar);
        });
        los_milisegundos.addEventListener('change', () => {
            mostrarElemento(btnIniciar);
        });

        las_horas.addEventListener('change', () => {
            mostrarElemento(btnIniciar);
        });

        const milisegundosaHorasMinutosSegundos = milisegundos => {
            const horas = Math.floor(milisegundos / 3600000);
            const minutos = Math.floor((milisegundos - (horas * 3600000)) / 60000);
            const segundos = Math.floor((milisegundos - (horas * 3600000) - (minutos * 60000)) / 1000);
            const milisegundos_ = milisegundos - (horas * 3600000) - (minutos * 60000) - (segundos * 1000);
            return {
                horas,
                minutos,
                segundos,
                milisegundos
            };
        }
        
        function iniciarTemporizador(){
            let horas = document.getElementById('horas');
            let minutos = document.getElementById('minutos');
            let segundos = document.getElementById('segundos');
            let milisegundos = document.getElementById('milisegundos');
            
            if(horas.value == ''){
                horas.value = '00';
            }else{
                horas.value = parseInt(horas.value);
            }

            if(minutos.value == ''){
                minutos.value = '00';
            }else{
                minutos.value = parseInt(minutos.value);
            }

            if(segundos.value == ''){
                segundos.value = '00';
            }else{
                segundos.value = parseInt(segundos.value);
            }
            comenzar_temporizador(horas.value, minutos.value, segundos.value);
        }

        const restablecerTemporizador = () => {
            clearInterval(idInterval);
            fechaFuturo = null;
            diferenciaTemporal = 0;
            las_horas.value = "";
            los_minutos.value = "";
            los_segundos.value = "";
            los_milisegundos.value = "000";
            mostrarElemento(message);
            ocultarElemento(btnIniciar);
            ocultarElemento(btnRestablecer);
            ocultarElemento(btnPausar);
        }

        const pausarTemporizador = () => {
            clearInterval(idInterval);
            mostrarElemento(btnPausar);
            ocultarElemento(btnIniciar);
            ocultarElemento(btnRestablecer);
        }

        const comenzar_temporizador = (horas, minutos, segundos) => {
            console.log(horas, minutos, segundos);
            ocultarElemento(message);
            mostrarElemento(btnPausar);
            mostrarElemento(btnRestablecer);
            mostrarElemento(btnIniciar);
            if(fechaFuturo){
                fechaFuturo = new Date(new Date().getTime() - diferenciaTemporal);
                diferenciaTemporal = 0;
            }else{
                const tiempoEnMiliSegundos = (horas * 60 * 60 * 1000) + (minutos * 60 * 1000) + (segundos * 1000);
                console.log(tiempoEnMiliSegundos)
                fechaFuturo = new Date(new Date().getTime() + tiempoEnMiliSegundos);
                console.log(fechaFuturo);
            }
            clearInterval(idInterval);
            idInterval = setInterval(() => {
                const tiempoRestante = fechaFuturo.getTime() - new Date().getTime();
                if(tiempoRestante <= 0){
                    clearInterval(idInterval);
                    ocultarElemento(btnPausar);
                    ocultarElemento(btnRestablecer);
                }else{
                    ocultarElemento(btnIniciar);
                    let mostrarTiempo = milisegundosaHorasMinutosSegundos(tiempoRestante);
                    las_horas.value = mostrarTiempo.horas;
                    los_minutos.value = mostrarTiempo.minutos;
                    los_segundos.value = mostrarTiempo.segundos;
                    los_milisegundos.value = mostrarTiempo.milisegundos;
                }
            }, 50);
        };
    </script>
</body>
</html>